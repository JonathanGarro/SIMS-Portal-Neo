{% extends "layout.html" %}
{% block content %}
	<div class="container">
		<div class="" id="hideMe">
			{% with messages = get_flashed_messages(with_categories=true) %}
				   {% if messages %}
					   {% for category, message in messages %}
						   <div class="alert alert-{{ category }}">
							   {{ message }} 
						   </div>
					   {% endfor %}
				   {% endif %}
			{% endwith %}
		</div>
		<div class="row my-5">
			<div class="col-md-8">
				<h3>Active Assignments <span class="badge rounded-pill bg-danger" id="smallbadge">{{count_active_assignments.AssignmentCount}}</span></h3>
				<h5 class="text-secondary mb-5">Members Currently Supporting Operations</h5>
				<table class='table'>
					<thead>
						<tr>
							<th>Member</th>
							<th>Emergency</th>
							<th>Assignment</th>
							<th>Start</th>
							<th>End</th>
						</tr>
					</thead>
					<tbody>
						{% for assignment in active_assignments %}
							<tr>
								<td class="fw-bold"><a href="/profile/view/{{assignment.user_id}}" class='link-danger'>{{assignment.firstname}} {{assignment.lastname}}</a></td>
								<td><a href="/emergency/{{assignment.emergency_id}}" class='link-danger'>{{assignment.emergency_name}}</a></td>
								<td><a href='/assignment/{{assignment[0]}}'>{{assignment.role}}</a></td>
								<td>{{assignment.start_date}}</td>
								<td>{{assignment.end_date}}</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
				
				
				{% for assignment in active_assignments %}
				<div class="card text-dark mb-3">
				  <div class="row g-0">
					<div class="col">
						<div class="card-header"><span class="fw-bold">{{assignment.firstname}} {{assignment.lastname}}</span></div>
					  <div class="card-body">
						<h4 class="text-danger">{{assignment.emergency_name}}</h4>
						<h5><a href="/view/assignment/{{assignment.id}}" class="text-dark font-italic">{{assignment.role}}</a></h5>

						<p class="card-text">{{assignment.assignment_details}}</p>
					  </div>
					</div>
				  </div>
				</div>
				{% endfor %}
				
				<h3 class="pt-5">Latest Surge Alerts</h3>
				<h5 class="text-secondary mb-3">via GO API</h5>
				<table class="table table-striped table-sm" id="datatable">
				  <thead class="text-danger">
					<tr>
					  <th scope="col">Event</th>
					  <th scope="col">Position</th>
					  <th scope="col">Alert Date</th>
					  <th scope="col">Location</th>
					</tr>
				  </thead>
				  <tbody>
					{% for alert in surge_alerts %}
					<tr>
					  <td class="fw-bold align-middle"><a href="https://go.ifrc.org/emergencies/{{alert.event_go_id}}" class="text-dark">{{alert.event_name}}</a></td>
					  <td class="align-middle">{{alert.role_profile}}</td>
					  <td class="align-middle">{{alert.alert_date}}</td>
					  <td class="align-middle">{{alert.location}}</td>
					</tr>
					{% endfor %}
				  </tbody>
				</table>
				
				<div class="row">
					<div class="col my-auto">
					<a href="/static/scripts/get_IM_alerts.py" download rel='noopener noreferrer' target= "_blank"><button type="button" class="btn btn-outline-secondary btn-sm mt-5">Download Python Snippet for this GO API Call</button></a>
					</div>
					<div class="col my-auto">
						<span class="text-sm text-secondary float-end"></span>	
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card mb-5" style="">
					  <div class="card-header">Announcements and Reminders</div>
					  <div class="card-body text-dark">
						<h5 class="card-title">Weekly SIMS Calls</h5>
							<p class="card-text mb-4">Calls take place Thursdays at 15:00 UTC on Zoom. <a href="https://britishredcross.zoom.us/j/207753634?pwd=dFUyRnNEOC9PazFkVVJ1VWx3MGM2UT09" class="link-danger">Click to join.</a></p>
						<h5 class="card-title">Mobile Data Training</h5>
							<p class="card-text mb-2">A mobile data collection training will be held online starting at 09:00 UTC on 28 February, 2022.</p>
					  </div>
				</div>
					<div class="card mb-5" style="">
					  <div class="card-header">Latest SIMS Emergencies</div>
					  <div class="card-body text-dark">
						<table class="table table-sm">
						  <thead class="text-danger">
							<tr>
								  <th scope="col">Event</th>
								  <th scope="col">GO ID</th>
							</tr>
						  </thead>
						  <tbody>
						{% for emergency in most_recent_emergencies %}
							<tr>
								<td class="fw-bold"><a href="/emergency/{{emergency.id}}" class="link-danger">{{emergency.emergency_name}}</a></td>
								<td><a href="https://go.ifrc.org/emergencies/{{emergency.emergency_go_id}}" class="link-secondary">{{emergency.emergency_go_id}}</a></td>
							</tr>
						{% endfor %}
						  </tbody>
						</table>
							
					  </div>
				</div>
			</div>
		</div>
	</div>
{% endblock content %}

